  - platform: moon
  - platform: darksky
    api_key: !secret darksky_api
    monitored_conditions:
      - summary
      - hourly_summary
      - daily_summary
      - icon
      - temperature
      - apparent_temperature
      - temperature_high
      - temperature_low
      - humidity
      - visibility
      - pressure
      - uv_index
  - platform: template
    sensors:
      livingroom_wireless_switch_battery:
        entity_id: 
          - binary_sensor.wall_switch_158d0001830c7c
        friendly_name: 'Living Room Wireless Switch'
        value_template: '{{ states.binary_sensor.wall_switch_158d0001830c7c.attributes.battery_level }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      button_switch_battery:
        entity_id:
          - binary_sensor.switch_158d00018721c6
        friendly_name: 'Button Switch'
        value_template: '{{ states.binary_sensor.switch_158d00018721c6.attributes.battery_level }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      cube_battery:
        friendly_name: 'Cube'
        entity_id:
          - binary_sensor.cube_158d000103a8a5_2
        value_template: '{{ states.binary_sensor.cube_158d000103a8a5_2.attributes.battery_level }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      backdoor_battery:
        entity_id:
          - binary_sensor.door_window_sensor_158d0002b82d0a
        friendly_name: 'Back Door Sensor'
        value_template: '{{ states.binary_sensor.door_window_sensor_158d0002b82d0a.attributes.battery_level}}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      frontdoor_battery:
        entity_id:
          - binary_sensor.door_window_sensor_158d00019e1738
        friendly_name: 'Front Door Sensor'
        value_template: '{{ states.binary_sensor.door_window_sensor_158d00019e1738.attributes.battery_level}}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      hall_motion_battery:
        entity_id: 
          - binary_sensor.motion_sensor_158d0001655f53
        friendly_name: 'Hall Motion Sensor'
        value_template: '{{ states.binary_sensor.motion_sensor_158d0001655f53.attributes.battery_level }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      hall_wireless_switch_battery:
        entity_id:
          - binary_sensor.wall_switch_both_158d00017110b8
        friendly_name: 'Hall Wireless Switch'
        value_template: '{{ states.binary_sensor.wall_switch_both_158d00017110b8.attributes.battery_level }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      temperaure__sensor_battery:
        entity_id:
          - sensor.humidity_158d0001b9205b
        friendly_name: 'Temperature Sensor'
        value_template: '{{ states.sensor.humidity_158d0001b9205b.attributes.battery_level }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      landing_motion_battery:
        entity_id:
          - binary_sensor.motion_sensor_158d000187392e
        friendly_name: 'Landing Motion Sensor'
        value_template: '{{ states.binary_sensor.motion_sensor_158d000187392e.attributes.battery_level }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      toilet_leak_sensor_battery:
        entity_id:
          - binary_sensor.water_leak_sensor_158d0001c3472b
        friendly_name: 'Hall Toilet Leak Sensor'
        value_template: '{{ states.binary_sensor.water_leak_sensor_158d0001c3472b.attributes.battery_level }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      outside_motion_sensor_battery:
        entity_id:
          - sensor.illumination_158d0001e43e18
        friendly_name: 'Outside Motion Sensor'
        value_template: '{{ states.sensor.illumination_158d0001e43e18.attributes.battery_level }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      patio_door_battery:
        entity_id:
          - binary_sensor.door_window_sensor_158d00019e18bf
        friendly_name: 'Patio Door Sensor'
        value_template: '{{ states.binary_sensor.door_window_sensor_158d00019e18bf.attributes.battery_level }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      utility_leak_sensor_battery:
        entity_id:
          - binary_sensor.water_leak_sensor_158d0001c347c9
        friendly_name: 'Utility Leak Sensor'
        value_template: '{{ states.binary_sensor.water_leak_sensor_158d0001c347c9.attributes.battery_level }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      tradfri_dimmer_battery:
        entity_id:
          - sensor.tradfri_wireless_dimmer
        friendly_name: 'Tradfri Dimmer'
        value_template: '{{ states.sensor.tradfri_wireless_dimmer.attributes.battery_level | float(2) }}'
        icon_template: mdi:battery
        unit_of_measurement: "%"
      since_last_boot_templated:
        friendly_name: "Last reboot"
        value_template: >-
          {%- set slb = states.sensor.since_last_boot.state.split(' ') -%}
          {%- set count = slb | length -%}
          {%- set hms = slb[count - 1] -%}
          {%- set hms_trimmed = hms.split('.')[0] -%}
          {%- set hms_split = hms_trimmed.split(':') -%}
          {%- set hours = hms_split[0] | int -%}
          
          {%- if count == 3 -%}
            {{ slb[0] ~ ' ' ~ slb[1] ~ ' ' }}
          {%- endif -%}
          {%- if hours > 0 -%}
            {%- if hours == 1 -%}
              1 hour
            {%- else -%}
              {{ hours }} hours
            {%- endif -%}
          {%- endif -%}
      temperature_high_templated:
        entity_id:
          - sensor.dark_sky_daytime_high_temperature
        friendly_name: 'Temperature High'
        value_template: "{{ states('sensor.dark_sky_daytime_high_temperature') | round (1) }}"
        icon_template: mdi:thermometer
        unit_of_measurement: "%"
      temperature_low_templated:
        entity_id:
          - sensor.dark_sky_overnight_low_temperature
        friendly_name: 'Temperature Low'
        value_template: "{{ states('sensor.dark_sky_overnight_low_temperature') | round (1) }}"
        icon_template: mdi:thermometer
        unit_of_measurement: "%"
      lrsync:
        friendly_name: 'Livingroom Light Sync'
        value_template: >-
          {% if is_state('light.lr1_2', 'unavailable') 
          and is_state('light.lr2', 'unavailable') 
          and is_state('light.lr3_2', 'unavailable') 
          and is_state('light.dr1', 'unavailable') 
          and is_state('light.dr2', 'unavailable') 
          and is_state('light.dr3', 'unavailable')  %}
            off
          {% elif not is_state('light.lr1_2', 'unavailable') 
          and not is_state('light.lr2', 'unavailable') 
          and not is_state('light.lr3_2', 'unavailable') 
          and not is_state('light.dr1', 'unavailable') 
          and not is_state('light.dr2', 'unavailable') 
          and not is_state('light.dr3', 'unavailable')  %}
            on
          {% else %}
            unknown
          {% endif %}
      harmony:
        entity_id:
          - remote.harmony_hub
        friendly_name: "Harmony"
        value_template: >-
          {% if states.remote.harmony_hub.attributes.current_activity == "PowerOff" %}
            Off
          {% elif states.remote.harmony_hub.attributes.current_activity == "Speaker" %}
            Speaker
          {% elif states.remote.harmony_hub.attributes.current_activity == "Sony" %}
            Sony
          {% elif states.remote.harmony_hub.attributes.current_activity == "Watch Roku" %}
            Roku
          {% elif states.remote.harmony_hub.attributes.current_activity == "L Gee" %}
            LG
          {% elif states.remote.harmony_hub.attributes.current_activity == "TV" %}
            Gigablue
          {% elif states.remote.harmony_hub.attributes.current_activity == "Blue Ray" %}
            Blue Ray
          {% endif %}
      alexa_alarm:
        entity_id:
          - sensor.alexa
        friendly_name: "Alexa Alarm"
        value_template: >-
          {% set numfiles = states.sensor.alexa.attributes.number_of_files|float %}
          {% if numfiles  == 0 %}
            off
          {% else %}
            on
          {% endif %}
  - platform: systemmonitor
    resources:
      - type: disk_free
        arg: /
      - type: disk_use_percent
        arg: /
      - type: memory_free
      - type: memory_use
      - type: swap_use
      - type: swap_free
      - type: processor_use
      - type: last_boot
  - platform: scrape
    resource: http://192.168.1.91/web/subservices
    name: TV Channel 
    select: 'e2servicename'
  - platform: scrape
    resource: http://192.168.1.91/web/getcurrent
    name: TV Program 
    select: 'e2eventtitle'
  - platform: scrape
    resource: http://192.168.1.91/web/powerstate
    name: Gigablue Power State
    select: 'e2instandby'
    value_template: '{{value.replace("true","off")|replace("false","on") }}'
  - platform: command_line
    name: Last Alexa
    scan_interval: 14400
    command: 'python3 /config/alexa/alexa_wrapper.py {{ "-lastalexa" }}' 
  - platform: folder
    folder: /config/alexa
    filter: .alexa.login
    friendly_name: "Alexa Alarm trigger"
 
    
    
   
